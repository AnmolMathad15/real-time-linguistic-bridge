<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clean App Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üß™ Clean Application Test</h1>
    <button onclick="runTests()">Run All Tests</button>
    <div id="test-results"></div>

    <script src="frontend/script.js"></script>
    <script>
        async function runTests() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<h2>Running tests...</h2>';
            
            let html = '';
            let passed = 0, failed = 0;
            
            // Test 1: Class Availability
            html += '<div class="test-section">';
            html += '<h3>1. Class Availability Test</h3>';
            
            const requiredClasses = [
                'VoiceInterface',
                'IntentClassifier', 
                'TranslationEngine',
                'PriceDiscoveryEngine',
                'NegotiationAssistant',
                'ResponseGenerator',
                'PrivacyManager',
                'AccessibilityManager',
                'CulturalContextManager',
                'LinguisticBridge'
            ];
            
            let classTestPassed = true;
            requiredClasses.forEach(className => {
                if (typeof window[className] !== 'undefined') {
                    html += `‚úÖ ${className}: Available<br>`;
                } else {
                    html += `‚ùå ${className}: Missing<br>`;
                    classTestPassed = false;
                }
            });
            
            html += '</div>';
            if (classTestPassed) passed++; else failed++;
            
            // Test 2: Class Instantiation
            html += '<div class="test-section">';
            html += '<h3>2. Class Instantiation Test</h3>';
            
            let instantiationPassed = true;
            try {
                const voiceInterface = new VoiceInterface();
                html += '‚úÖ VoiceInterface: Can instantiate<br>';
            } catch (error) {
                html += `‚ùå VoiceInterface: ${error.message}<br>`;
                instantiationPassed = false;
            }
            
            try {
                const intentClassifier = new IntentClassifier();
                html += '‚úÖ IntentClassifier: Can instantiate<br>';
            } catch (error) {
                html += `‚ùå IntentClassifier: ${error.message}<br>`;
                instantiationPassed = false;
            }
            
            try {
                const responseGenerator = new ResponseGenerator();
                html += '‚úÖ ResponseGenerator: Can instantiate<br>';
            } catch (error) {
                html += `‚ùå ResponseGenerator: ${error.message}<br>`;
                instantiationPassed = false;
            }
            
            html += '</div>';
            if (instantiationPassed) passed++; else failed++;
            
            // Test 3: Browser API Support
            html += '<div class="test-section">';
            html += '<h3>3. Browser API Support Test</h3>';
            
            let apiTestPassed = true;
            if (VoiceInterface.isSupported()) {
                html += '‚úÖ Speech Recognition: Supported<br>';
            } else {
                html += '‚ö†Ô∏è Speech Recognition: Not supported (expected in some browsers)<br>';
            }
            
            if ('speechSynthesis' in window) {
                html += '‚úÖ Speech Synthesis: Supported<br>';
            } else {
                html += '‚ùå Speech Synthesis: Not supported<br>';
                apiTestPassed = false;
            }
            
            html += '</div>';
            if (apiTestPassed) passed++; else failed++;
            
            // Test 4: Intent Classification
            html += '<div class="test-section">';
            html += '<h3>4. Intent Classification Test</h3>';
            
            let intentTestPassed = true;
            try {
                const classifier = new IntentClassifier();
                const result = await classifier.classifyIntent('what is the price of onions', 'english');
                
                if (result && result.type && result.confidence !== undefined) {
                    html += `‚úÖ Intent Classification: Working<br>`;
                    html += `   - Detected: ${result.type}<br>`;
                    html += `   - Product: ${result.product}<br>`;
                    html += `   - Confidence: ${result.confidence.toFixed(2)}<br>`;
                } else {
                    html += '‚ùå Intent Classification: Invalid result<br>';
                    intentTestPassed = false;
                }
            } catch (error) {
                html += `‚ùå Intent Classification: ${error.message}<br>`;
                intentTestPassed = false;
            }
            
            html += '</div>';
            if (intentTestPassed) passed++; else failed++;
            
            // Test 5: Response Generation
            html += '<div class="test-section">';
            html += '<h3>5. Response Generation Test</h3>';
            
            let responseTestPassed = true;
            try {
                const responseGenerator = new ResponseGenerator();
                const testData = {
                    intent: { type: 'bargaining', product: 'onions', category: 'vegetables' },
                    priceData: { 
                        product: 'onions', 
                        marketPrice: 40, 
                        unit: 'kg',
                        ranges: { minimum: 35, premium: 50 },
                        negotiation: { flexibility: 'high' }
                    },
                    negotiationGuidance: { 
                        counterOffers: [{ 
                            price: 38, 
                            message: 'Good bulk price', 
                            recommended: true 
                        }],
                        confidence: 0.8 
                    }
                };
                
                const response = await responseGenerator.formatResponse(testData, 'english');
                
                if (response && response.text && response.text.length > 0) {
                    html += '‚úÖ Response Generation: Working<br>';
                    html += `   - Response: "${response.text.substring(0, 100)}..."<br>`;
                    html += `   - Language: ${response.language}<br>`;
                } else {
                    html += '‚ùå Response Generation: No response text<br>';
                    responseTestPassed = false;
                }
            } catch (error) {
                html += `‚ùå Response Generation: ${error.message}<br>`;
                responseTestPassed = false;
            }
            
            html += '</div>';
            if (responseTestPassed) passed++; else failed++;
            
            // Test 6: Main Application
            html += '<div class="test-section">';
            html += '<h3>6. Main Application Test</h3>';
            
            let appTestPassed = true;
            try {
                if (window.linguisticBridge) {
                    html += '‚úÖ LinguisticBridge: Initialized<br>';
                    html += `   - Current Language: ${window.linguisticBridge.currentLanguage}<br>`;
                    html += `   - Processing: ${window.linguisticBridge.isProcessing}<br>`;
                } else {
                    html += '‚ùå LinguisticBridge: Not initialized<br>';
                    appTestPassed = false;
                }
            } catch (error) {
                html += `‚ùå Main Application: ${error.message}<br>`;
                appTestPassed = false;
            }
            
            html += '</div>';
            if (appTestPassed) passed++; else failed++;
            
            // Summary
            const totalTests = 6;
            const successRate = ((passed / totalTests) * 100).toFixed(1);
            
            html += `<div class="test-section ${passed === totalTests ? 'success' : 'error'}">`;
            html += '<h3>üìä Test Summary</h3>';
            html += `<p>‚úÖ Passed: ${passed}/${totalTests}</p>`;
            html += `<p>‚ùå Failed: ${failed}/${totalTests}</p>`;
            html += `<p>üìà Success Rate: ${successRate}%</p>`;
            
            if (passed === totalTests) {
                html += '<p><strong>üéâ All tests passed! The application is working correctly.</strong></p>';
            } else {
                html += '<p><strong>‚ö†Ô∏è Some tests failed. Check the details above.</strong></p>';
            }
            
            html += '</div>';
            
            results.innerHTML = html;
        }
        
        // Auto-run tests when page loads
        window.addEventListener('load', () => {
            setTimeout(runTests, 1000);
        });
    </script>
</body>
</html>