<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Verification - Real-Time Linguistic Bridge</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .test-pass {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-fail {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>Final Verification Test</h1>
    <p><em>Verifying all components are properly integrated and functional</em></p>
    
    <div class="test-container">
        <h2>Component Verification</h2>
        <button onclick="runVerification()">Run Verification Tests</button>
        <div id="verification-results"></div>
    </div>

    <div class="test-container">
        <h2>Application Preview</h2>
        <p>The main application should be accessible at: <a href="../frontend/index.html" target="_blank">frontend/index.html</a></p>
        <p>Property-based tests available at: <a href="property-tests.html" target="_blank">property-tests.html</a></p>
    </div>

    <!-- Load application components -->
    <script src="../tests/test-setup.js"></script>
    <script src="../frontend/script.js"></script>
    
    <script>
        function addResult(name, passed, details) {
            const resultsDiv = document.getElementById('verification-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
            resultDiv.innerHTML = `
                <strong>${passed ? '‚úÖ' : '‚ùå'} ${name}</strong><br>
                ${details}
            `;
            resultsDiv.appendChild(resultDiv);
        }

        function runVerification() {
            document.getElementById('verification-results').innerHTML = '';
            
            console.log('üîç Running final verification tests...');
            
            // Test 1: Check if main classes are defined
            try {
                const classes = [
                    'LinguisticBridge',
                    'VoiceInterface', 
                    'IntentClassifier',
                    'TranslationEngine',
                    'PriceDiscoveryEngine',
                    'NegotiationAssistant',
                    'ResponseGenerator',
                    'PrivacyManager',
                    'AccessibilityManager',
                    'CulturalContextManager'
                ];
                
                let allDefined = true;
                let missingClasses = [];
                
                for (const className of classes) {
                    if (typeof window[className] === 'undefined') {
                        allDefined = false;
                        missingClasses.push(className);
                    }
                }
                
                addResult('Core Classes Defined', allDefined, 
                    allDefined ? 'All 10 core classes are properly defined' : `Missing classes: ${missingClasses.join(', ')}`);
                
            } catch (error) {
                addResult('Core Classes Defined', false, `Error: ${error.message}`);
            }
            
            // Test 2: Check IntentClassifier functionality
            try {
                const classifier = new IntentClassifier();
                const intent = classifier.classifyIntent('price kya hai', 'hindi');
                
                const isValid = (
                    typeof intent === 'object' &&
                    typeof intent.type === 'string' &&
                    typeof intent.confidence === 'number'
                );
                
                addResult('Intent Classification', isValid, 
                    isValid ? `Intent classification working: ${intent.type} (confidence: ${intent.confidence})` : 'Intent classification failed');
                
            } catch (error) {
                addResult('Intent Classification', false, `Error: ${error.message}`);
            }
            
            // Test 3: Check PriceDiscoveryEngine functionality
            try {
                const priceEngine = new PriceDiscoveryEngine();
                const priceData = priceEngine.getMarketPrice('rice');
                
                const isValid = (
                    typeof priceData === 'object' &&
                    typeof priceData.minPrice === 'number' &&
                    typeof priceData.avgPrice === 'number' &&
                    typeof priceData.maxPrice === 'number'
                );
                
                addResult('Price Discovery', isValid, 
                    isValid ? `Price discovery working: ‚Çπ${priceData.minPrice}-${priceData.maxPrice}` : 'Price discovery failed');
                
            } catch (error) {
                addResult('Price Discovery', false, `Error: ${error.message}`);
            }
            
            // Test 4: Check TranslationEngine functionality
            try {
                const translator = new TranslationEngine();
                const translation = translator.translate('price kya hai', 'hindi', 'english');
                
                const isValid = (
                    typeof translation === 'string' &&
                    translation.length > 0
                );
                
                addResult('Translation Engine', isValid, 
                    isValid ? `Translation working: "${translation}"` : 'Translation failed');
                
            } catch (error) {
                addResult('Translation Engine', false, `Error: ${error.message}`);
            }
            
            // Test 5: Check NegotiationAssistant functionality
            try {
                const assistant = new NegotiationAssistant();
                const mockIntent = { type: 'bargaining', product: 'rice', confidence: 0.8 };
                const mockPrice = { minPrice: 50, avgPrice: 60, maxPrice: 70 };
                const guidance = assistant.generateGuidance(mockIntent, mockPrice, 'too expensive');
                
                const isValid = (
                    typeof guidance === 'object' &&
                    typeof guidance.suggestion === 'string' &&
                    typeof guidance.reasoning === 'string'
                );
                
                addResult('Negotiation Assistant', isValid, 
                    isValid ? 'Negotiation guidance generation working' : 'Negotiation assistant failed');
                
            } catch (error) {
                addResult('Negotiation Assistant', false, `Error: ${error.message}`);
            }
            
            // Test 6: Check ResponseGenerator functionality
            try {
                const generator = new ResponseGenerator();
                const mockData = {
                    intent: { type: 'casual_inquiry', product: 'rice' },
                    priceData: { minPrice: 50, avgPrice: 60, maxPrice: 70 },
                    negotiationGuidance: { suggestion: 'Fair price', reasoning: 'Market rate' }
                };
                const response = generator.formatResponse(mockData, 'english');
                
                const isValid = (
                    typeof response === 'object' &&
                    typeof response.text === 'string' &&
                    response.text.length > 0
                );
                
                addResult('Response Generator', isValid, 
                    isValid ? 'Response generation working' : 'Response generator failed');
                
            } catch (error) {
                addResult('Response Generator', false, `Error: ${error.message}`);
            }
            
            // Test 7: Check PrivacyManager functionality
            try {
                const privacy = new PrivacyManager();
                privacy.clearAudioData();
                privacy.clearSensitiveData();
                
                addResult('Privacy Manager', true, 'Privacy protection methods working');
                
            } catch (error) {
                addResult('Privacy Manager', false, `Error: ${error.message}`);
            }
            
            // Test 8: Check browser API support detection
            try {
                const speechSupported = VoiceInterface.isSupported();
                const ttsSupported = typeof window.speechSynthesis !== 'undefined';
                
                addResult('Browser API Support', true, 
                    `Speech Recognition: ${speechSupported ? 'Supported' : 'Not supported'}, TTS: ${ttsSupported ? 'Supported' : 'Not supported'}`);
                
            } catch (error) {
                addResult('Browser API Support', false, `Error: ${error.message}`);
            }
            
            console.log('‚úÖ Final verification completed');
        }
        
        // Auto-run verification when page loads
        window.addEventListener('load', () => {
            setTimeout(runVerification, 500);
        });
    </script>
</body>
</html>